name: Publish

on:
    release:
        types: [ created ]

jobs:
    deploy:

        runs-on: ubuntu-latest

        steps:
            -   uses: actions/checkout@master
            -   name: Set up Python
                uses: actions/setup-python@v4
                with:
                    python-version: '3.10'
            -   name: Install dependencies
                run: |
                    python -m pip install --upgrade pip
                    pip install poetry
            -   name: Build and publish
                run: |
                    poetry version $(git describe --tags --abbrev=0)
                    poetry build
                    poetry publish --username ${{ secrets.PYPI_API_USERNAME }} --password ${{ secrets.PYPI_API_TOKEN }}
